\begin{algorithm}[H]
\DontPrintSemicolon
\KwData{$\mathcal{D}$, $\tilde{\mathcal{B}}$, $\gamma$, a model $Q\in (\Real^2)^{S \ocA}$, a regression algorithm \texttt{fit}, a set of CPU workers $W$}
\KwResult{$Q^*$}
$Q \leftarrow 0$\;
$X \leftarrow \{s_i,a_i,\beta_i\}_{i\in[0, |\cD|]}$\;
\Repeat{convergence}{
   evaluate $Q(\mathcal{D}, \cA, \tilde{\cB})$ in a single forward pass\;
   split $\mathcal{D}$ among workers: $\mathcal{D} = \cup_{w\in W} \mathcal{D}_w$\;
   \For(\tcp*[f]{Run in parallel}){$w\in W$}{
       \For{$(\boldsymbol{\cdot},\beta_i,\boldsymbol{\cdot},\boldsymbol{\cdot},\boldsymbol{\cdot},s'_i) \in \mathcal{D}$} {
           $\cP \leftarrow \{(Q_c(s_i',\cA,\tilde{\cB}), Q_r(s_i',\cA,\tilde{\cB}))\}$\;
           $\cH \leftarrow \texttt{convex\_hull}(\cP).\text{vertices}()$\tcp*[f]{in cw order}\;
           $\cH.\texttt{prune}()$ \tcp*[f]{Remove all dominated points}\;
           $k \leftarrow \min\{k: \beta_i \geq q_c$ with $\left(q_c,q_r\right) = \cH[k]\}$\;
           $q_c^2,q_r^2,q_c^1,q_r^1 \leftarrow \cH[k],\cH[k-1]$\;
           $p \leftarrow (\beta_i - q_a^1) / (q_c^2 - q_c^1)$\;
           $Y_c^{w,i} \leftarrow c_i + \gamma ((1-p) q_c^1+ p q_c^2)$\;
           $Y_r^{w,i} \leftarrow r_i + \gamma ((1-p) q_r^1+ p q_r^2)$\;
       }
   }
   Join the results: $Y \leftarrow \cup_{w\in W} (Y_c^w, Y_r^w)$\;
   $Q \leftarrow \texttt{fit}(X, Y)$\;
}
\caption{Scalable BFTQ}
\label{algo:bftq_full}
\end{algorithm}